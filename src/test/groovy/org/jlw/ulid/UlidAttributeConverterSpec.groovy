package org.jlw.ulid

import spock.lang.Specification

class UlidAttributeConverterSpec extends Specification {
    def "conversion"(final String value, final long msb, final long lsb) {
        when:
        var ulid = new ULID(msb, lsb)

        then:
        new UlidAttributeConverter().convertToDatabaseColumn(ulid) == value.toUpperCase()
        new UlidAttributeConverter().convertToEntityAttribute(value) == ulid

        where:
        value                        | msb                | lsb
        '01F99HJBJ384MW83WGSWVYE52N' | 106488908812075305 | -4319074297954495403
        '01F99HJBJ9A3S5PDM9QPAM4MGM' | 106488908812472562 | 6572592153539793428
        '01F99HJBJAZN26Z8VS8DAQQQX1' | 106488908812582212 | 8044406689517789089
        '01F99HJBJA7BM8K7D7PJGVZ849' | 106488908812532456 | -8530477724920209271
        '01F99HJBJA73MQQ397NA7KHRTE' | 106488908812531945 | 8902815651882132302
        '01F99HJBJAZ0X6JNX61B5442NC' | 106488908812580922 | 7590718262229469868
        '01F99HJBJAXXDCMZNT6BDBKAQV' | 106488908812578650 | -3855439503401833733
        '01F99HJBJA6ZMX65BZEE8XAQAJ' | 106488908812531689 | -3236540622851187374
        '01F99HJBJACF9SH0C6CEBHPXEH' | 106488908812542931 | -7457531745653787183
        '01F99HJBJARDDY4TDJW31M6R6D' | 106488908812567387 | -2131976270164827955
        '01F99HJBJAKVAD4NBZM6C2F1SH' | 106488908812558036 | -3290583620705089743
        '01F99HJBJBC41DZ9N469H4KZ09' | 106488908812607746 | -2330995220813317111
        '01F99HJBJB2ZPZT51XQZ117GKG' | 106488908812589037 | -210475388775447952
        '01F99HJBJB6XFFTAJXFG8BZJN5' | 106488908812597086 | -204248045653603675
        '01F99HJBJBN0DBSCHPGZDNRE2J' | 106488908812625946 | -4849753891595863982
        '01F99HJBJC3JFJ0TTBGQEK1GJ3' | 106488908812655775 | 2336043870035427907
        '01F99HJBJCBJT3ARC5HH16P441' | 106488908812672180 | 3846502394207342721
        '01F99HJBJC9XHJR5EF6YCEFXQ1' | 106488908812668771 | 3176672949875242721
        '01f99hjbj384mw83wgswvye52n' | 106488908812075305 | -4319074297954495403
        '01f99hjbj9a3s5pdm9qpam4mgm' | 106488908812472562 | 6572592153539793428
        '01f99hjbjazn26z8vs8daqqqx1' | 106488908812582212 | 8044406689517789089
        '01f99hjbja7bm8k7d7pjgvz849' | 106488908812532456 | -8530477724920209271
        '01f99hjbja73mqq397na7khrte' | 106488908812531945 | 8902815651882132302
        '01f99hjbjaz0x6jnx61b5442nc' | 106488908812580922 | 7590718262229469868
        '01f99hjbjaxxdcmznt6bdbkaqv' | 106488908812578650 | -3855439503401833733
        '01f99hjbja6zmx65bzee8xaqaj' | 106488908812531689 | -3236540622851187374
        '01f99hjbjacf9sh0c6cebhpxeh' | 106488908812542931 | -7457531745653787183
        '01f99hjbjarddy4tdjw31m6r6d' | 106488908812567387 | -2131976270164827955
        '01f99hjbjakvad4nbzm6c2f1sh' | 106488908812558036 | -3290583620705089743
        '01f99hjbjbc41dz9n469h4kz09' | 106488908812607746 | -2330995220813317111
        '01f99hjbjb2zpzt51xqz117gkg' | 106488908812589037 | -210475388775447952
        '01f99hjbjb6xfftajxfg8bzjn5' | 106488908812597086 | -204248045653603675
        '01f99hjbjbn0dbschpgzdnre2j' | 106488908812625946 | -4849753891595863982
        '01f99hjbjc3jfj0ttbgqek1gj3' | 106488908812655775 | 2336043870035427907
        '01f99hjbjcbjt3arc5hh16p441' | 106488908812672180 | 3846502394207342721
        '01f99hjbjc9xhjr5ef6ycefxq1' | 106488908812668771 | 3176672949875242721
    }

    def "bad ulid"(final String value) {
        when:
        new UlidAttributeConverter().convertToEntityAttribute(value)

        then:
        thrown(IllegalArgumentException.class)

        where:
        value << [
                '',
                ' ',
                '01F99HJBJAZN2',
                '01F99HJBJA7BMIK7D7PJGVZ849',
                '01F99HJBJA73MQU3L7NA7KHRTE',
                '01F99HJBJAZ0X6JNXO1B5442NC',
                '01f99hjbjazn2',
                '01f99hjbja7bmik7d7pjgvz849',
                '01f99hjbja73mqu3l7na7khrte',
                '01f99hjbjaz0x6jnxo1b5442nc',
        ]
    }
}
